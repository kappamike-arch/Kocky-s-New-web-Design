(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4921],{33:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},6191:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},11010:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]])},16485:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},17386:(e,t,a)=>{Promise.resolve().then(a.bind(a,48520))},18085:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},45105:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(12115),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(e,t)=>{let a=(0,s.forwardRef)((a,n)=>{let{color:l="currentColor",size:c=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:d="",children:m,...u}=a;return(0,s.createElement)("svg",{ref:n,...r,width:c,height:c,stroke:l,strokeWidth:o?24*Number(i)/Number(c):i,className:["lucide","lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()),d].join(" "),...u},[...t.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(m)?m:[m]])});return a.displayName="".concat(e),a}},48520:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(95155),r=a(12115),n=a(11010),l=a(16485),c=a(18085),i=a(33),o=a(65229),d=a(6191),m=a(71360),u=a(89678),x=a(95704);function p(){let[e,t]=(0,r.useState)([]),[a,x]=(0,r.useState)(!0),[p,y]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!1),[j,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{N()},[]);let N=async()=>{try{x(!0);let e=(await u.F.get("/email/campaigns")).data,a=Array.isArray(e)?e:[];t(a)}catch(e){console.error("Failed to fetch campaigns:",e)}finally{x(!1)}},w=async e=>{if(confirm("Are you sure you want to delete this campaign?"))try{(await fetch("/api/email/campaigns/".concat(e),{method:"DELETE"})).ok&&N()}catch(e){console.error("Failed to delete campaign:",e)}},k=async e=>{if(confirm("Are you sure you want to send this campaign now?"))try{let t=await fetch("/api/email/campaigns/".concat(e,"/send-now"),{method:"POST"});if(t.ok){let e=await t.json();alert("Campaign sent! ".concat(e.sent," emails sent out of ").concat(e.total," recipients.")),N()}else{let e=await t.json();alert("Error: ".concat(e.error))}}catch(e){console.error("Failed to send campaign:",e),alert("Failed to send campaign")}},C=async e=>{if(confirm("Are you sure you want to cancel this campaign?"))try{(await fetch("/api/email/campaigns/".concat(e,"/cancel"),{method:"POST"})).ok&&N()}catch(e){console.error("Failed to cancel campaign:",e)}},A=async(e,t)=>{try{(await fetch("/api/email/campaigns/".concat(e,"/schedule"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scheduledAt:t})})).ok&&(b(!1),v(null),N())}catch(e){console.error("Failed to schedule campaign:",e)}};return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Email Campaigns"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Create and manage your email campaigns"})]}),(0,s.jsxs)("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"New Campaign"]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campaign"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Template"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Schedule"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stats"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"Loading campaigns..."})}):0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"No campaigns found"})}):e.map(e=>{var t,a;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.subject}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["From: ",e.fromName||e.fromEmail]})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:(null==(t=e.template)?void 0:t.name)||"No template"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"DRAFT":default:return"bg-gray-100 text-gray-800";case"SCHEDULED":return"bg-blue-100 text-blue-800";case"SENDING":return"bg-yellow-100 text-yellow-800";case"SENT":return"bg-green-100 text-green-800";case"CANCELLED":return"bg-red-100 text-red-800"}})(e.status)),children:[(e=>{switch(e){case"DRAFT":default:return(0,s.jsx)(n.A,{className:"h-4 w-4"});case"SCHEDULED":return(0,s.jsx)(l.A,{className:"h-4 w-4"});case"SENDING":return(0,s.jsx)(c.A,{className:"h-4 w-4"});case"SENT":return(0,s.jsx)(i.A,{className:"h-4 w-4"});case"CANCELLED":return(0,s.jsx)(o.A,{className:"h-4 w-4"})}})(e.status),(0,s.jsx)("span",{className:"ml-1",children:e.status})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.scheduledAt?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:new Date(e.scheduledAt).toLocaleDateString()}),(0,s.jsx)("div",{className:"text-xs",children:new Date(e.scheduledAt).toLocaleTimeString()})]}):e.sentAt?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:["Sent: ",new Date(e.sentAt).toLocaleDateString()]}),(0,s.jsx)("div",{className:"text-xs",children:new Date(e.sentAt).toLocaleTimeString()})]}):"Not scheduled"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(i.A,{className:"h-4 w-4 mr-1"}),(null==(a=e._count)?void 0:a.events)||0," events"]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsxs)("div",{className:"flex gap-2",children:["DRAFT"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>k(e.id),className:"text-green-600 hover:text-green-900",title:"Send Now",children:(0,s.jsx)(c.A,{className:"h-4 w-4"})}),(0,s.jsx)("button",{onClick:()=>{v(e),b(!0)},className:"text-blue-600 hover:text-blue-900",title:"Schedule",children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})]}),"SCHEDULED"===e.status&&(0,s.jsx)("button",{onClick:()=>C(e.id),className:"text-red-600 hover:text-red-900",title:"Cancel",children:(0,s.jsx)(o.A,{className:"h-4 w-4"})}),(0,s.jsx)("button",{onClick:()=>w(e.id),className:"text-red-600 hover:text-red-900",title:"Delete",children:(0,s.jsx)(m.A,{className:"h-4 w-4"})})]})})]},e.id)})})]})})}),p&&(0,s.jsx)(h,{onClose:()=>y(!1),onSuccess:()=>{y(!1),N()}}),f&&j&&(0,s.jsx)(g,{campaign:j,onClose:()=>{b(!1),v(null)},onSchedule:e=>A(j.id,e)})]})}function h(e){let{onClose:t,onSuccess:a}=e,[n,l]=(0,r.useState)({name:"",subject:"",fromName:"",fromEmail:x.env.NEXT_PUBLIC_EMAIL_FROM||"no-reply@kockys.com",templateId:"",segmentTags:"",html:""}),[c,i]=(0,r.useState)([]);(0,r.useEffect)(()=>{o()},[]);let o=async()=>{try{let e=await fetch("/api/email-templates"),t=await e.json();i(t||[])}catch(e){console.error("Failed to fetch templates:",e)}},d=async e=>{e.preventDefault();try{let e=await fetch("/api/email/campaigns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,segmentTags:n.segmentTags?n.segmentTags.split(",").map(e=>e.trim()):[]})});if(e.ok)a();else{let t=await e.json();alert("Error: ".concat(t.error))}}catch(e){console.error("Failed to create campaign:",e),alert("Failed to create campaign")}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Create New Campaign"}),(0,s.jsxs)("form",{onSubmit:d,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Campaign Name *"}),(0,s.jsx)("input",{type:"text",required:!0,value:n.name,onChange:e=>l(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Line *"}),(0,s.jsx)("input",{type:"text",required:!0,value:n.subject,onChange:e=>l(t=>({...t,subject:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Name"}),(0,s.jsx)("input",{type:"text",value:n.fromName,onChange:e=>l(t=>({...t,fromName:e.target.value})),placeholder:"Kocky's Bar & Grill",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Email *"}),(0,s.jsx)("input",{type:"email",required:!0,value:n.fromEmail,onChange:e=>l(t=>({...t,fromEmail:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),(0,s.jsxs)("select",{value:n.templateId,onChange:e=>l(t=>({...t,templateId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"",children:"No template (use custom HTML)"}),c.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Segment Tags (comma-separated)"}),(0,s.jsx)("input",{type:"text",value:n.segmentTags,onChange:e=>l(t=>({...t,segmentTags:e.target.value})),placeholder:"newsletter, vip, customer",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to send to all consenting contacts"})]}),!n.templateId&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom HTML"}),(0,s.jsx)("textarea",{rows:10,value:n.html,onChange:e=>l(t=>({...t,html:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm",placeholder:"Enter your HTML content..."})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Campaign"})]})]})]})})}function g(e){let{campaign:t,onClose:a,onSchedule:n}=e,[l,c]=(0,r.useState)("");return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Schedule Campaign"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-4",children:['Schedule "',t.name,'" to be sent at a specific time.']}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l&&n(l)},children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Send Date & Time *"}),(0,s.jsx)("input",{type:"datetime-local",required:!0,value:l,onChange:e=>c(e.target.value),min:new Date().toISOString().slice(0,16),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Schedule Campaign"})]})]})]})})}},51431:function(e){e.exports=function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)e[s]=a[s]}return e}return function t(a,s){function r(t,r,n){if("undefined"!=typeof document){"number"==typeof(n=e({},s,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var c in n)n[c]&&(l+="; "+c,!0!==n[c]&&(l+="="+n[c].split(";")[0]));return document.cookie=t+"="+a.write(r,t)+l}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],s={},r=0;r<t.length;r++){var n=t[r].split("="),l=n.slice(1).join("=");try{var c=decodeURIComponent(n[0]);if(s[c]=a.read(l,c),e===c)break}catch(e){}}return e?s[e]:s}},remove:function(t,a){r(t,"",e({},a,{expires:-1}))},withAttributes:function(a){return t(this.converter,e({},this.attributes,a))},withConverter:function(a){return t(e({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(s)},converter:{value:Object.freeze(a)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},65229:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71360:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(45105).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},76329:(e,t,a)=>{"use strict";a.d(t,{H$:()=>n});var s=a(95704);let r=("staging"===s.env.NEXT_PUBLIC_ENV,"http://staging.kockys.com"),n="".concat(r,"/api");console.log("\uD83D\uDD27 API Configuration:"),console.log("  Environment:","production"),console.log("  Custom ENV:",s.env.NEXT_PUBLIC_ENV),console.log("  API Base URL:",r),console.log("  Full API URL:",n)},89678:(e,t,a)=>{"use strict";a.d(t,{F:()=>c});var s=a(95125),r=a(76329),n=a(95704);let l=a(51431);n.env.NEXT_PUBLIC_CMS_URL;let c=s.A.create({baseURL:r.H$,headers:{"Content-Type":"application/json"},withCredentials:!0});c.interceptors.request.use(e=>{console.log("API Request:",e.baseURL+e.url);let t=l.get("auth-token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),c.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===401&&(l.remove("auth-token"),window.location.pathname.startsWith("/admin")&&(window.location.href="/login")),Promise.reject(e)})}},e=>{e.O(0,[5125,8441,1255,7358],()=>e(e.s=17386)),_N_E=e.O()}]);