(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2837],{6191:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7122:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(95155),r=s(12115),i=s(20063),n=s(35626),o=s(20508),l=s(23664),c=s(69141),d=s(6191),u=s(71360),m=s(46046),x=s(18085),p=s(91163),h=s(52619),y=s.n(h),g=s(22663);function f(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),s=e.id,[h,f]=(0,r.useState)(null),[v,j]=(0,r.useState)(!0),[b,N]=(0,r.useState)(!1),[w,q]=(0,r.useState)(!1),[k,A]=(0,r.useState)({serviceDetails:"",validDays:30,terms:"Payment Terms:\n- 50% deposit required to confirm booking\n- Balance due 7 days before event\n- Cancellation policy applies\n\nService Includes:\n- Professional staff\n- Setup and breakdown\n- All equipment and supplies\n\nAdditional Terms:\n- Service subject to availability\n- Prices valid for 30 days\n- Travel fees may apply for distant locations",notes:""}),[P,C]=(0,r.useState)([{description:"",quantity:1,unitPrice:0,total:0,notes:""}]);(0,r.useEffect)(()=>{S()},[s]);let S=async()=>{try{console.log("[Quote Creation] Fetching inquiry with ID: ".concat(s));let e=await fetch("http://72.167.227.205:5001/api/crm/inquiries/".concat(s));if(!e.ok){let t=await e.text();console.error("[Quote Creation] API error: ".concat(e.status," - ").concat(t)),404===e.status?g.Ay.error("Inquiry not found (ID: ".concat(s,")")):500===e.status?g.Ay.error("Server error while fetching inquiry"):g.Ay.error("Failed to load inquiry: ".concat(e.statusText));return}let t=await e.json();console.log("[Quote Creation] Inquiry data received:",t);let a=t.data||t;if(!a)return void g.Ay.error("No inquiry data received");f(a);let r=[];a.serviceType&&r.push("Service Type: ".concat(a.serviceType)),a.eventDate&&r.push("Event Date: ".concat((0,p.GP)(new Date(a.eventDate),"MMMM dd, yyyy"))),a.eventLocation&&r.push("Location: ".concat(a.eventLocation)),a.guestCount&&r.push("Guest Count: ".concat(a.guestCount)),A(e=>({...e,serviceDetails:r.join("\n")}));let i=D(a.serviceType);C(i)}catch(e){console.error("[Quote Creation] Error fetching inquiry:",e),g.Ay.error("Failed to load inquiry: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{j(!1)}},D=e=>{switch(e){case"FOOD_TRUCK":return[{description:"Food Truck Service (4 hours)",quantity:1,unitPrice:1500,total:1500,notes:""},{description:"Additional Hour",quantity:0,unitPrice:350,total:0,notes:""},{description:"Menu Package - Standard",quantity:1,unitPrice:25,total:25,notes:"Per person"}];case"MOBILE_BAR":return[{description:"Mobile Bar Service (4 hours)",quantity:1,unitPrice:800,total:800,notes:""},{description:"Professional Bartender",quantity:2,unitPrice:200,total:400,notes:""},{description:"Premium Bar Package",quantity:1,unitPrice:500,total:500,notes:""}];case"CATERING":return[{description:"Catering Service",quantity:1,unitPrice:0,total:0,notes:""},{description:"Per Person Rate",quantity:1,unitPrice:45,total:45,notes:""},{description:"Service Staff",quantity:2,unitPrice:150,total:300,notes:""}];default:return[{description:"",quantity:1,unitPrice:0,total:0,notes:""}]}},M=(e,t,s)=>{let a=[...P];a[e]={...a[e],[t]:s},("quantity"===t||"unitPrice"===t)&&(a[e].total=a[e].quantity*a[e].unitPrice),C(a)},T=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];N(!0),q(e);try{console.log("[Quote Creation] Creating quote for inquiry ".concat(s));let a=new Date;a.setDate(a.getDate()+k.validDays);let r={amount:P.filter(e=>e.description).reduce((e,t)=>e+t.total,0),validUntil:a.toISOString(),serviceDetails:k.serviceDetails,terms:k.terms,notes:k.notes,quoteItems:P.filter(e=>e.description).map(e=>({description:e.description,quantity:e.quantity,unitPrice:e.unitPrice,total:e.total,notes:e.notes})),sendToCustomer:!1};console.log("[Quote Creation] Request body:",r);let i=await fetch("http://72.167.227.205:5001/api/crm/inquiries/".concat(s,"/quotes"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok){let e=await i.text();console.error("[Quote Creation] Failed to create quote: ".concat(i.status," - ").concat(e)),404===i.status?g.Ay.error("Inquiry not found"):400===i.status?g.Ay.error("Invalid quote data provided"):g.Ay.error("Failed to create quote: ".concat(i.statusText));return}let n=await i.json();console.log("[Quote Creation] Quote created:",n),e&&n.id?(await fetch("http://72.167.227.205:5001/api/quotes/".concat(n.id,"/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Please find attached our quote for your requested service. We look forward to serving you!"})})).ok?g.Ay.success("Quote created and sent successfully!"):g.Ay.success("Quote created but failed to send. You can send it later."):g.Ay.success("Quote created successfully!"),t.push("/crm")}catch(e){console.error("[Quote Creation] Error creating quote:",e),g.Ay.error("Failed to create quote: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{N(!1)}};return v?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):h?(0,a.jsxs)("div",{className:"p-6 max-w-6xl mx-auto",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(y(),{href:"/inquiries",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(n.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Create Quote"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Creating quote for inquiry from ",h.name]})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Customer Information"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Name"}),(0,a.jsx)("p",{className:"font-medium",children:h.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,a.jsx)("p",{className:"font-medium",children:h.email})]})]}),h.phone&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Phone"}),(0,a.jsx)("p",{className:"font-medium",children:h.phone})]})]})]}),h.companyName&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Company"}),(0,a.jsx)("p",{className:"font-medium",children:h.companyName})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Quote Details"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Service Details"}),(0,a.jsx)("textarea",{value:k.serviceDetails,onChange:e=>A({...k,serviceDetails:e.target.value}),rows:4,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary",placeholder:"Describe the services to be provided..."})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Valid for (days)"}),(0,a.jsx)("input",{type:"number",value:k.validDays,onChange:e=>A({...k,validDays:parseInt(e.target.value)||30}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Valid Until"}),(0,a.jsx)("input",{type:"text",value:(0,p.GP)(new Date(Date.now()+24*k.validDays*36e5),"MMMM dd, yyyy"),readOnly:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Line Items"}),(0,a.jsxs)("button",{onClick:()=>{C([...P,{description:"",quantity:1,unitPrice:0,total:0,notes:""}])},className:"flex items-center gap-2 px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary-dark",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"Add Item"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),(0,a.jsx)("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Qty"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Unit Price"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Notes"}),(0,a.jsx)("th",{className:"px-4 py-2"})]})}),(0,a.jsx)("tbody",{children:P.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("input",{type:"text",value:e.description,onChange:e=>M(t,"description",e.target.value),className:"w-full px-2 py-1 border rounded",placeholder:"Item description"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("input",{type:"number",value:e.quantity,onChange:e=>M(t,"quantity",parseInt(e.target.value)||0),className:"w-16 px-2 py-1 border rounded text-center",min:"0"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("input",{type:"number",value:e.unitPrice,onChange:e=>M(t,"unitPrice",parseFloat(e.target.value)||0),className:"w-24 px-2 py-1 border rounded text-right",step:"0.01",min:"0"})}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right font-medium",children:["$",e.total.toFixed(2)]}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>M(t,"notes",e.target.value),className:"w-full px-2 py-1 border rounded",placeholder:"Optional notes"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("button",{onClick:()=>{C(P.filter((e,s)=>s!==t))},className:"text-red-600 hover:text-red-800",children:(0,a.jsx)(u.A,{className:"w-4 h-4"})})})]},t))}),(0,a.jsx)("tfoot",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("td",{colSpan:3,className:"px-4 py-3 text-right font-semibold",children:"Total:"}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right font-bold text-lg",children:["$",P.reduce((e,t)=>e+t.total,0).toFixed(2)]}),(0,a.jsx)("td",{colSpan:2})]})})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Terms & Conditions"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Terms"}),(0,a.jsx)("textarea",{value:k.terms,onChange:e=>A({...k,terms:e.target.value}),rows:8,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary font-mono text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Internal Notes (not shown to customer)"}),(0,a.jsx)("textarea",{value:k.notes,onChange:e=>A({...k,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary",placeholder:"Any internal notes about this quote..."})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{onClick:()=>t.back(),className:"px-6 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,a.jsxs)("button",{onClick:()=>T(!1),disabled:b,className:"flex items-center gap-2 px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),"Save as Draft"]}),(0,a.jsxs)("button",{onClick:()=>T(!0),disabled:b,className:"flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50",children:[(0,a.jsx)(x.A,{className:"w-4 h-4"}),"Save & Send"]})]})]}):(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg",children:"Inquiry not found"})})}},18085:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},20063:(e,t,s)=>{"use strict";var a=s(47260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},20508:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},23664:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},35626:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},46046:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},68504:(e,t,s)=>{Promise.resolve().then(s.bind(s,7122))},69141:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},71360:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},e=>{e.O(0,[2663,9067,2619,8441,1255,7358],()=>e(e.s=68504)),_N_E=e.O()}]);