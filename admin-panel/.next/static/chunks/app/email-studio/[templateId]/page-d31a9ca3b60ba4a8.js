(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[574],{7273:(e,t,a)=>{Promise.resolve().then(a.bind(a,43255))},43255:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var l=a(95155),s=a(12115);let r=(e,t)=>{let a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},n=e=>{let{label:t,children:a,hint:s}=e;return(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-slate-700",children:t}),s&&(0,l.jsx)("span",{className:"text-xs text-slate-400",children:s})]}),a]})},i=e=>{let{children:t,className:a="",...s}=e;return(0,l.jsx)("button",{className:"px-3 py-2 rounded-xl shadow-sm border border-slate-200 bg-white hover:bg-slate-50 active:bg-slate-100 transition ".concat(a),...s,children:t})},o=e=>{let{children:t,className:a="",...s}=e;return(0,l.jsx)("button",{className:"px-3 py-2 rounded-xl shadow border border-indigo-500 bg-indigo-600 text-white hover:bg-indigo-500 transition ".concat(a),...s,children:t})};function c(e){let{html:t}=e,a=(0,s.useRef)(null);return s.useEffect(()=>{var e;let l=null==(e=a.current)?void 0:e.contentDocument;l&&(l.open(),l.write(t),l.close())},[t]),(0,l.jsx)("iframe",{ref:a,className:"w-full h-[540px] rounded-2xl border border-slate-200 shadow-sm bg-white"})}function d(e){let{title:t,defaults:a,templateId:d,onSave:x}=e,[p,m]=(0,s.useState)(a.brand),[u,h]=(0,s.useState)(a.sections),[b,g]=(0,s.useState)(a.theme),[f,y]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),w=(0,s.useMemo)(()=>(function(e){let{brand:t,sections:a,theme:l}=e,s=t.banner||"",r=t.logo||"",n=l.accent||"#111827",i=l.text||"#111827",o=l.bg||"#ffffff",c=e=>(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'<!doctype html>\n  <html>\n  <head>\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1"/>\n    <title>'.concat(c(t.subject||"Kocky's Email"),'</title>\n    <style>\n      .btn{display:inline-block;padding:12px 16px;border-radius:10px;text-decoration:none}\n    </style>\n  </head>\n  <body style="margin:0;background:').concat(o,";color:").concat(i,';font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif">\n    <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background:').concat(o,'">\n      <tr>\n        <td align="center">\n          <table role="presentation" width="640" cellpadding="0" cellspacing="0" style="max-width:640px;width:100%">\n            ').concat(s?'<tr><td><img src="'.concat(s,'" alt="Banner" style="display:block;width:100%;height:auto;border:0"/></td></tr>'):"",'\n            <tr>\n              <td style="padding:24px 24px 8px">\n                <div style="display:flex;align-items:center;gap:12px">\n                  ').concat(r?'<img src="'.concat(r,'" alt="Logo" width="48" height="48" style="border-radius:12px"/>'):"",'\n                  <div>\n                    <div style="font-weight:700;font-size:18px">').concat(c(t.senderName||"Kocky's Bar & Grill"),'</div>\n                    <div style="font-size:12px;color:#6b7280">').concat(c(t.senderEmail||"info@kockys.com"),"</div>\n                  </div>\n                </div>\n              </td>\n            </tr>\n            ").concat(a.map(e=>{if("heading"===e.type)return'<tr><td style="padding:16px 24px 0"><h1 style="margin:0;font-size:24px;color:'.concat(n,'">').concat(c(e.text),"</h1></td></tr>");if("text"===e.type)return'<tr><td style="padding:8px 24px 0;line-height:1.6">'.concat(c(e.text).replace(/\n/g,"<br/>"),"</td></tr>");if("cta"===e.type){let t=e.color||n;return'<tr><td style="padding:16px 24px"><a class="btn" href="'.concat(c(e.href),'" style="background:').concat(t,';color:#fff" target="_blank">').concat(c(e.label),"</a></td></tr>")}return"divider"===e.type?'<tr><td style="padding:16px 24px"><hr style="border:none;height:1px;background:#e5e7eb"/></td></tr>':"two-col"===e.type?'<tr><td style="padding:12px 24px"><table width="100%" cellpadding="0" cellspacing="0"><tr><td style="width:50%;vertical-align:top;padding-right:8px">'.concat(c(e.left),'</td><td style="width:50%;vertical-align:top;padding-left:8px">').concat(c(e.right),"</td></tr></table></td></tr>"):""}).join(""),'\n            <tr>\n              <td style="padding:24px;color:#6b7280;font-size:12px">\n                <div>').concat(c(t.footer||"123 Main St, Fresno CA \xb7 (555) 555‑5555"),'</div>\n                <div><a href="#" style="color:#6b7280">Unsubscribe</a></div>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </table>\n  </body>\n</html>')})({brand:p,sections:u,theme:b}),[p,u,b]);(0,s.useEffect)(()=>{if(!f)return;let e=setInterval(async()=>{if(x){j(!0);try{await x({brand:p,sections:u,theme:b}),y(!1)}catch(e){console.error("Auto-save failed:",e)}finally{j(!1)}}},3e4);return()=>clearInterval(e)},[f,p,u,b,x]),(0,s.useEffect)(()=>{let e=e=>{f&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[f]);let N=e=>{e(),y(!0)},k=e=>{N(()=>{h(t=>[...t,"heading"===e?{type:"heading",text:"New headline"}:"text"===e?{type:"text",text:"New paragraph"}:"cta"===e?{type:"cta",label:"View Menu",href:"https://kockys.com",color:b.accent}:"divider"===e?{type:"divider"}:{type:"two-col",left:"Left text",right:"Right text"}])})},C=(e,t)=>{N(()=>{h(a=>a.map((a,l)=>l===e?{...a,...t}:a))})},T=async(e,t)=>{var a;let l=null==(a=e.target.files)?void 0:a[0];if(!l)return;let s=await new Promise((e,t)=>{let a=new FileReader;a.onload=()=>e(a.result),a.onerror=t,a.readAsDataURL(l)});N(()=>{m(e=>({...e,[t]:s}))})},S=async()=>{if(x){j(!0);try{await x({brand:p,sections:u,theme:b}),y(!1),alert("Template saved successfully!")}catch(e){alert("Failed to save template: "+e.message)}finally{j(!1)}}},E=async()=>{await navigator.clipboard.writeText(w),alert("HTML copied to clipboard")},q=async()=>{let e=prompt("Send test to email:",p.testTo||"info@kockys.com");if(e)try{if((await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e,subject:p.subject||"Test Email",html:w})})).ok)alert("Test email sent successfully!");else throw Error("Failed to send test email")}catch(e){alert("Failed to send test email: "+e.message)}};return(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold",children:t}),f&&(0,l.jsx)("p",{className:"text-sm text-orange-600 mt-1",children:"• Unsaved changes"}),v&&(0,l.jsx)("p",{className:"text-sm text-blue-600 mt-1",children:"• Saving..."})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(i,{onClick:S,disabled:v,children:v?"Saving...":"Save Template"}),(0,l.jsx)(i,{onClick:()=>{r("".concat((p.subject||"email").toLowerCase().replace(/\s+/g,"-"),".json"),JSON.stringify({brand:p,sections:u,theme:b},null,2))},children:"Export JSON"}),(0,l.jsx)(i,{onClick:E,children:"Copy HTML"}),(0,l.jsx)(o,{onClick:()=>{r("".concat((p.subject||"email").toLowerCase().replace(/\s+/g,"-"),".html"),w)},children:"Download HTML"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(n,{label:"Subject",children:(0,l.jsx)("input",{value:p.subject,onChange:e=>N(()=>m({...p,subject:e.target.value})),className:"w-full rounded-xl border border-slate-300 px-3 py-2"})}),(0,l.jsx)(n,{label:"Sender name",children:(0,l.jsx)("input",{value:p.senderName,onChange:e=>N(()=>m({...p,senderName:e.target.value})),className:"w-full rounded-xl border border-slate-300 px-3 py-2"})}),(0,l.jsx)(n,{label:"From email",children:(0,l.jsx)("input",{value:p.senderEmail,onChange:e=>N(()=>m({...p,senderEmail:e.target.value})),className:"w-full rounded-xl border border-slate-300 px-3 py-2"})}),(0,l.jsx)(n,{label:"Accent color",children:(0,l.jsx)("input",{type:"color",value:b.accent,onChange:e=>N(()=>g({...b,accent:e.target.value})),className:"w-full h-10 rounded-xl border border-slate-300"})}),(0,l.jsx)(n,{label:"Text color",children:(0,l.jsx)("input",{type:"color",value:b.text,onChange:e=>N(()=>g({...b,text:e.target.value})),className:"w-full h-10 rounded-xl border border-slate-300"})}),(0,l.jsx)(n,{label:"Background color",children:(0,l.jsx)("input",{type:"color",value:b.bg,onChange:e=>N(()=>g({...b,bg:e.target.value})),className:"w-full h-10 rounded-xl border border-slate-300"})}),(0,l.jsx)(n,{label:"Logo upload",hint:"PNG/JPG",children:(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>T(e,"logo")})}),(0,l.jsx)(n,{label:"Banner upload",hint:"1200\xd7400 recommended",children:(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>T(e,"banner")})}),(0,l.jsx)(n,{label:"Footer",children:(0,l.jsx)("input",{value:p.footer,onChange:e=>N(()=>m({...p,footer:e.target.value})),className:"w-full rounded-xl border border-slate-300 px-3 py-2"})})]}),(0,l.jsxs)("div",{className:"rounded-2xl border border-slate-200 p-4",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[(0,l.jsx)("span",{className:"text-sm text-slate-500",children:"Add block:"}),(0,l.jsx)(i,{onClick:()=>k("heading"),children:"Heading"}),(0,l.jsx)(i,{onClick:()=>k("text"),children:"Text"}),(0,l.jsx)(i,{onClick:()=>k("cta"),children:"CTA"}),(0,l.jsx)(i,{onClick:()=>k("two-col"),children:"Two‑column"}),(0,l.jsx)(i,{onClick:()=>k("divider"),children:"Divider"}),(0,l.jsx)(o,{className:"ml-auto",onClick:q,children:"Send test"})]}),(0,l.jsx)("div",{className:"space-y-3",children:u.map((e,t)=>(0,l.jsxs)("div",{className:"rounded-xl border border-slate-200 p-3 bg-white",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:e.type}),(0,l.jsx)("button",{className:"text-red-500 text-sm",onClick:()=>{N(()=>{h(e=>e.filter((e,a)=>a!==t))})},children:"Remove"})]}),"heading"===e.type&&(0,l.jsx)("input",{className:"w-full rounded-xl border border-slate-300 px-3 py-2",value:e.text,onChange:e=>C(t,{text:e.target.value})}),"text"===e.type&&(0,l.jsx)("textarea",{className:"w-full rounded-xl border border-slate-300 px-3 py-2 min-h-[90px]",value:e.text,onChange:e=>C(t,{text:e.target.value})}),"cta"===e.type&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,l.jsx)("input",{className:"rounded-xl border border-slate-300 px-3 py-2",placeholder:"Label",value:e.label,onChange:e=>C(t,{label:e.target.value})}),(0,l.jsx)("input",{className:"rounded-xl border border-slate-300 px-3 py-2",placeholder:"https://",value:e.href,onChange:e=>C(t,{href:e.target.value})}),(0,l.jsx)("input",{type:"color",className:"rounded-xl border border-slate-300",value:e.color||b.accent,onChange:e=>C(t,{color:e.target.value})})]}),"two-col"===e.type&&(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsx)("textarea",{className:"rounded-xl border border-slate-300 px-3 py-2 min-h-[70px]",value:e.left,onChange:e=>C(t,{left:e.target.value})}),(0,l.jsx)("textarea",{className:"rounded-xl border border-slate-300 px-3 py-2 min-h-[70px]",value:e.right,onChange:e=>C(t,{right:e.target.value})})]})]},t))})]})]}),(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h3",{className:"font-medium",children:"Live preview"}),(0,l.jsx)("span",{className:"text-xs text-slate-400",children:"640px canvas"})]}),(0,l.jsx)(c,{html:w})]})})]})}let x={inquiry:{brand:{subject:"Thanks for your inquiry — we got it!",senderName:"Kocky's Bar & Grill",senderEmail:"info@kockys.com",footer:"Kocky's Bar & Grill \xb7 123 Main St, Fresno CA",logo:"",banner:""},theme:{accent:"#4f46e5",text:"#111827",bg:"#ffffff"},sections:[{type:"heading",text:"We received your inquiry, {{customerName}}!"},{type:"text",text:"Thanks for reaching out about {{serviceName}}. Our team will reply within 1 business day."},{type:"cta",label:"View Menu",href:"https://kockys.com/menu",color:"#4f46e5"},{type:"divider"},{type:"text",text:"Questions? Reply to this email or call (555) 555‑5555."}]},quote:{brand:{subject:"Your quote from Kocky's (##{{quoteNumber}})",senderName:"Kocky's Sales",senderEmail:"info@kockys.com",footer:"Kocky's \xb7 Quotes",logo:"",banner:""},theme:{accent:"#16a34a",text:"#0f172a",bg:"#ffffff"},sections:[{type:"heading",text:"Your quote is ready"},{type:"two-col",left:"Service: {{serviceName}}\nEvent Date: {{eventDate}}",right:"Total: {{total}}\nValid until: {{validUntil}}"},{type:"cta",label:"Approve & Pay Deposit",href:"https://staging.kockys.com/quotes/{{quoteId}}"},{type:"divider"},{type:"text",text:"If anything looks off, reply and we'll tweak it right away."}]},mobileBar:{brand:{subject:"Mobile Bar booking received",senderName:"Kocky's Events",senderEmail:"info@kockys.com",footer:"Kocky's \xb7 Events",logo:"",banner:""},theme:{accent:"#ea580c",text:"#1f2937",bg:"#ffffff"},sections:[{type:"heading",text:"Cheers, {{customerName}}!"},{type:"text",text:"Your Mobile Bar request is in. We'll confirm availability and send next steps."},{type:"cta",label:"See Packages",href:"https://staging.kockys.com/mobile-bar"}]}};function p(e){let{templateId:t}=e,[a,r]=(0,s.useState)(null),[n,i]=(0,s.useState)(!0),[o,c]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{i(!0);let e=await fetch("/api/email-templates/studio/".concat(t));if(e.ok){let t=await e.json();r(t)}else if(404===e.status)r(x[t]||x.inquiry);else throw Error("Failed to fetch template")}catch(e){console.error("Error fetching template:",e),c(e.message),r(x[t]||x.inquiry)}finally{i(!1)}})()},[t]);let p=async e=>{if(!(await fetch("/api/email-templates/studio/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to save template")};return n?(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-slate-600",children:"Loading template..."})]})}):a?(0,l.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,l.jsx)("header",{className:"sticky top-0 z-10 backdrop-blur bg-white/80 border-b border-slate-200",children:(0,l.jsxs)("div",{className:"max-w-6xl mx-auto px-6 py-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xl font-semibold",children:"Kocky's Email Template Studio"}),o&&(0,l.jsx)("p",{className:"text-sm text-orange-600 mt-1",children:"⚠ Using fallback template (server data unavailable)"})]}),(0,l.jsx)("nav",{className:"flex gap-2",children:(0,l.jsx)("a",{href:"/admin/email-templates",className:"px-3 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 text-sm",children:"← Back to Templates"})})]})}),(0,l.jsx)("main",{className:"max-w-6xl mx-auto",children:(0,l.jsx)(d,{title:{inquiry:"Inquiry Confirmation Template",quote:"Quote / Proposal Template",mobileBar:"Mobile Bar Booking Template"}[t]||"Template: ".concat(t),defaults:a,templateId:t,onSave:p})}),(0,l.jsx)("footer",{className:"max-w-6xl mx-auto px-6 pb-10 text-center text-sm text-slate-400",children:"Built for Kocky's \xb7 Upload logos/banners, edit blocks, preview, export HTML/JSON, and Send Test."})]}):(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Template Not Found"}),(0,l.jsxs)("p",{className:"text-slate-600 mb-4",children:['The template "',t,'" could not be found.']}),(0,l.jsx)("a",{href:"/admin/email-templates",className:"text-indigo-600 hover:text-indigo-500",children:"← Back to Templates"})]})})}function m(e){let{params:t}=e;return(0,l.jsx)(p,{templateId:t.templateId})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=7273)),_N_E=e.O()}]);